{% extends "base.html" %}

{% block title %}Список заказов{% endblock %}
{% block header_title %}Заказы ({{ role }}){% endblock %}

{% block head_styles %}
<style>
    .filter-form {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        display: flex;
        gap: 15px;
        align-items: center;
    }
    .filter-form select, .filter-form button, .filter-form a {
        font-family: "Times New Roman", serif;
        padding: 8px 15px;
        border-radius: 3px;
        border: none;
        cursor: pointer;
        color: black;
        text-decoration: none;
    }
    
    .orders-table {
        width: 100%;
        border-collapse: collapse;
        font-family: "Times New Roman", serif;
    }
    .orders-table th, .orders-table td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    .orders-table th {
        background-color: var(--accent-color);
        font-weight: bold;
    }
    .orders-table tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    /* Визуальное выделение статусов */
    .status-новый { background-color: #ffcccc; } 
    .status-в-сборке { background-color: #ffffcc; }
    .status-доставлен-в-пвз { background-color: #ccffcc; }
    .status-завершен { background-color: var(--secondary-bg); }
    .status-отменен { background-color: #cccccc; } 
    
    .actions-group a, .actions-group button {
        padding: 4px 8px;
        border-radius: 3px;
        font-size: 0.9em;
        margin-left: 5px;
        display: inline-block;
        border: none;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}

<form method="GET" action="{{ url_for('orders') }}" class="filter-form">
    
    <label for="status" style="padding: 0;">Статус заказа:</label>
    <select name="status" id="status">
        {% for status in statuses %}
        <option value="{{ status }}" {% if status == selected_status %}selected{% endif %}>{{ status }}</option>
        {% endfor %}
    </select>

    <button type="submit" style="background-color: var(--accent-color);">Применить</button>
    <a href="{{ url_for('orders') }}" style="background-color: var(--secondary-bg);">Сбросить</a>
    
    {% if role == 'Администратор' %}
        <a href="{{ url_for('order_crud', order_id='new') }}" style="background-color: var(--accent-color); margin-left: auto;">Добавить заказ</a>
    {% endif %}
</form>

<table class="orders-table">
    <thead>
        <tr>
            <th>Артикулы (Кол-во)</th>
            <th>Статус заказа</th>
            <th>Адрес пункта выдачи</th>
            <th>Дата заказа</th>
            <th>Дата доставки</th>
            {% if role == 'Администратор' %}
            <th>Действия</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for order in orders %}
        <tr>
            <td>{{ order.ArticleQuantityList | default('Нет товаров') }}</td>
            <td class="status-{{ order.StatusName.lower().replace(' ', '-').replace('ё', 'е') }}">
                {{ order.StatusName }}
            </td>
            <td>{{ order.PickupAddress }}</td>
            <td>{{ order.OrderDate }}</td>
            <td>{{ order.DeliveryDate }}</td>
            
            {% if role == 'Администратор' %}
            <td class="actions-group">
                <a href="{{ url_for('order_crud', order_id=order.OrderID) }}" style="background-color: var(--accent-color); color: black;">Ред.</a>
                <form method="POST" action="{{ url_for('order_delete', order_id=order.OrderID) }}" onsubmit="return confirm('Удалить заказ {{ order.OrderID }}?');" style="display: inline;">
                    <button type="submit" style="background-color: red; color: white;">Удал.</button>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if not orders %}
    <p style="text-align: center; margin-top: 20px;">Заказы не найдены.</p>
{% endif %}

{% endblock %}